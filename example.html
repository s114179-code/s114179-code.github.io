<!IDOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <title>宜蕙的網站</title>
    <link rel="icon" href="5bbe86970d244a4fbe3713c16f8c6e6c.jpeg">

  <meta charset="utf-8" />
  <title>Flappy Bird - 玩家姓名版</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --bg:#70c5ce; --pipe:#2d8a3a; --bird:#ffdd57; }
    html,body { margin:0; height:100%; display:flex; justify-content:center; align-items:center; background:var(--bg); font-family:Arial; }
    .wrap { width:360px; text-align:center; }
    canvas { margin-top:12px; background:linear-gradient(#70c5ce,#6fc2ca); border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.2); }
    #nameBox { 
        position:absolute; 
        top:20px; left:50%; transform:translateX(-50%);
        background:white; padding:14px; border-radius:10px; 
        box-shadow:0 4px 16px rgba(0,0,0,0.2);
        text-align:center;
    }
    #nameInput { width:180px; padding:6px; border:1px solid #aaa; border-radius:6px; }
    #startBtn { margin-top:10px; padding:6px 14px; border:none; border-radius:6px; background:#4CAF50; color:white; cursor:pointer; }
  </style>
</head>
<body>

<div id="nameBox">
  <div style="font-size:18px; font-weight:bold;">請輸入玩家名稱</div>
  <input id="nameInput" placeholder="你的名字">
  <br>
  <button id="startBtn">開始遊戲</button>
</div>

<div class="wrap">
  <canvas id="game" width="360" height="600"></canvas>
</div>

<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const nameBox = document.getElementById("nameBox");
  const nameInput = document.getElementById("nameInput");
  const startBtn = document.getElementById("startBtn");

  let playerName = "";
  let highScore = 0; // 跟名字綁定

  const GRAVITY = 0.9;
  const FLAP = -12;

  let bird, pipes, frameCount, score, state;

  function loadHighScore(name){
    return Number(localStorage.getItem("flappy_highscore_" + name)) || 0;
  }

  function saveHighScore(name, score){
    localStorage.setItem("flappy_highscore_" + name, score);
  }

  function reset() {
    bird = {
      x: 80,
      y: canvas.height / 2 - 20,
      w: 34,
      h: 24,
      vy: 0,
      rotation: 0
    };
    pipes = [];
    frameCount = 0;
    score = 0;
    state = "ready";
  }

  function spawnPipe() {
    const gap = 140;
    const top = 50 + Math.random() * (canvas.height - 220);
    pipes.push({
      x: canvas.width + 10,
      w: 54,
      topHeight: top,
      bottomHeight: canvas.height - top - gap,
      passed: false
    });
  }

  function collides(b, p) {
    if (b.x + b.w > p.x && b.x < p.x + p.w) {
      if (b.y < p.topHeight || b.y + b.h > canvas.height - p.bottomHeight) return true;
    }
    if (b.y + b.h >= canvas.height || b.y <= 0) return true;
    return false;
  }

  function draw() {
    // 背景
    const g = ctx.createLinearGradient(0,0,0,canvas.height);
    g.addColorStop(0,'#70c5ce');
    g.addColorStop(1,'#6fc2ca');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // 管子
    ctx.fillStyle = "#2d8a3a";
    pipes.forEach(p => {
      ctx.fillRect(p.x, 0, p.w, p.topHeight);
      ctx.fillRect(p.x, canvas.height - p.bottomHeight, p.w, p.bottomHeight);
    });

    // 小鳥
    ctx.save();
    ctx.translate(bird.x + bird.w/2, bird.y + bird.h/2);
    ctx.rotate(bird.rotation);
    ctx.fillStyle = "#ffdd57";
    ctx.fillRect(-bird.w/2, -bird.h/2, bird.w, bird.h);

    ctx.fillStyle = "#333";
    ctx.fillRect(bird.w/8, -4, 6, 6);
    ctx.restore();

    // 顯示玩家名
    ctx.fillStyle = "#fff";
    ctx.font = "22px Arial";
    ctx.fillText("玩家: " + playerName, 12, 30);

    // 分數
    ctx.fillText("Score: " + score, 12, 65);

    // 最高分
    ctx.fillText("High: " + highScore, 12, 100);

    if (state === "ready") {
      ctx.fillStyle = "rgba(0,0,0,0.6)";
      ctx.font = "22px Arial";
      ctx.textAlign = "center";
      ctx.fillText("點擊或按空白鍵開始", canvas.width / 2, canvas.height / 2 - 20);
    }

    if (state === "gameover") {
      ctx.fillStyle = "rgba(255,0,0,0.95)";
      ctx.font = "44px Arial";
      ctx.textAlign = "center";
      ctx.fillText("Game Over", canvas.width / 2, canvas.height / 2 - 20);

      ctx.fillStyle = "#fff";
      ctx.font = "20px Arial";
      ctx.fillText("最終分數: " + score, canvas.width / 2, canvas.height / 2 + 35);
      ctx.fillText("最高紀錄: " + highScore, canvas.width / 2, canvas.height / 2 + 70);
      ctx.fillText("點擊或按空白重新開始", canvas.width / 2, canvas.height / 2 + 110);
    }
  }

  function update() {
    if (state === "playing") {
      bird.vy += GRAVITY;
      bird.y += bird.vy;
      bird.rotation = Math.max(-0.6, Math.min(1.2, bird.vy * 0.03));

      if (frameCount % 110 === 0) spawnPipe();

      for (let p of pipes) {
        p.x -= 2.6;

        if (!p.passed && (p.x + p.w) < bird.x) {
          score++;
          p.passed = true;
        }

        if (collides(bird, p)) {
          if (score > highScore) {
            highScore = score;
            saveHighScore(playerName, highScore);
          }
          state = "gameover";
        }
      }

      pipes = pipes.filter(p => p.x + p.w > -10);
    }

    frameCount++;
  }

  function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
  }

  function flap() {
    if (state === "ready") {
      state = "playing";
      bird.vy = FLAP;
    } else if (state === "playing") {
      bird.vy = FLAP;
    } else if (state === "gameover") {
      reset();
    }
  }

  // 玩家姓名輸入
  startBtn.onclick = () => {
    playerName = nameInput.value.trim();
    if (playerName === "") {
      alert("請先輸入名字！");
      return;
    }

    highScore = loadHighScore(playerName);
    nameBox.style.display = "none";
    reset();
  };

  // 控制
  window.addEventListener("keydown", e => {
    if (e.code === "Space") {
      e.preventDefault();
      flap();
    }
  });

  canvas.addEventListener("mousedown", flap);
  canvas.addEventListener("touchstart", e => {
    e.preventDefault();
    flap();
  }, {passive:false});

  loop();
</script>
</body>
</html>

  
